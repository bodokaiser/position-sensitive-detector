\section{Preamplifier}

The photocurrents created by our detector are in the range of microampere where they are vulnerable to noise.
Using a preamplifier, we can increase the amplitude of the signal for an improved signal-to-noise ratio.
The typical photocurrent preamplifier is based on the transimpedance (current-to-voltage) amplifier design using a voltage-feedback operational amplifier.
Converting the current to a voltage signal has the benefit that the voltage signal can be easily visualized with an oscilloscope.
Furthermore, the voltage-feedback operational amplifier design appears to be more common than the current-feedback operational amplifier, as manufacturers offer much more choice and they are more prominent in the literature.
That said, current feedback operational amplifiers are reported to be a viable solution for high-speed and high-bandwidth applications, see Ref.~\cite[p.~110]{Jung05} for an overview of the benefits of current feedback amplifiers and Ref.~\cite[Ch.~9]{Carter17} for a comparison.

% TODO: mention feedback tee network for high feedback factor
% TODO: mention finite loop gain error (Jung, p. 13)
% TODO: table with op amp parameters specified in the datasheet and their relevance for our application
% TODO: noise model (Jung, p. 80)

\subsection{Gain}

\begin{figure}[H]
	\centering
	\begin{circuitikz}
		\draw (0, 0) node[op amp](opamp){};
		\draw (opamp.+) -- +(0, -1) node[ground](gnd1){};
		\draw (opamp.out) -- (3, 0) node[ocirc, label=$V_\text{out}$]{};
		\draw (opamp.-) to[current source, invert, l=$I_\text{in}$] +(-3, 0) node(node1){} -- (node1 |- gnd1) node[ground]{};
		\draw (opamp.-) |- (-1, 2) to[resistor, l=$R_f$] (1,2) -| (opamp.out);
	\end{circuitikz}
	\caption{Simple transimpedance amplifier circuit.}
\end{figure}

\begin{equation}
	V_\text{out}=R_fI_\text{in}
\end{equation}

\begin{figure}[H]
	\begin{subfigure}[t]{.5\textwidth}
		\centering
		\begin{circuitikz}
			\draw (0, 0) node[op amp](opamp){};
			\draw (opamp.+) -- +(0, -1) node[ground](gnd1){};
			\draw (opamp.out) -- +(.5, 0) node[ocirc, label=$V_\text{out}$]{};
			\draw (opamp.-) -- +(-3, 0) node(node1){} to[current source, invert, l=$I_\text{in}$] (node1 |- gnd1) node[ground]{};
			\draw (node1) -- +(1.5, 0) node(node2){} to[resistor, l=$R_\text{in}$] (node2 |- gnd1) node[ground]{};
			\draw (opamp.-) |- (-1, 2) to[resistor, l=$R_f$] (1,2) -| (opamp.out);
		\end{circuitikz}
		\caption{Transimpedance amplifier.}
	\end{subfigure}
	\begin{subfigure}[t]{.5\textwidth}
		\centering
		\begin{circuitikz}
			\draw (0, 0) node[op amp](opamp){};
			\draw (opamp.+) -- +(0, -1) node[ground](gnd1){};
			\draw (opamp.out) -- +(.5, 0) node[ocirc, label=$V_\text{out}$]{};
			\draw (opamp.-) to[resistor, l_=$R_\text{in}$] +(-3, 0) node(node1){} to[voltage source, l=$V_\text{in}{=}R_\text{in}I_\text{in}$] (node1 |- gnd1) node[ground]{};
			\draw (opamp.-) |- (-1, 2) to[resistor, l=$R_f$] (1,2) -| (opamp.out);
		\end{circuitikz}
		\caption{Inverting amplifier.}
	\end{subfigure}
	\caption{Equivalence between transimpedance and inverting amplifier using source transformation.}
\end{figure}

\subsection{Offset}

\subsubsection{Input offset voltage}

\cite[p.~54]{Jung05}

\begin{figure}[H]
	\centering
	\begin{circuitikz}
		\draw (0, 0) node[op amp](opamp){};
		\draw (opamp.out) -- +(.5, 0) node[ocirc, label=$V_\text{out}$]{};
		\draw (opamp.-) to[resistor, l_=$R_\text{in}$] +(-3, 0) node(node1){} to[voltage source, l=$V_\text{in}$] (node1 |- +0, -3) node[ground](gnd){};
		\draw (opamp.-) |- (-1, 2) to[resistor, l=$R_f$] (1,2) -| (opamp.out);
		\draw (opamp.+) -- ++(0, -1) node(node2)[circ]{};
		\draw (-2, -0.5) to[potentiometer, n=pot, l_=$R_p$] (-2, -2.5);
		\draw (node2) -- ++(2, 0) node(node3){} to[resistor, l_=$R_c$] (node3 |- gnd) node[ground]{};
		\draw (node2) -- (pot.wiper);
		\draw (-2, -0.5) node[ocirc, label=$+V_s$]{};
		\draw (-2, -2.5) node[ocirc, label=$-V_s$, rotate=180]{};
	\end{circuitikz}
	\caption{Input current offset compensation.}
\end{figure}

\subsubsection{Input bias current}

% TODO: mention that I+, I- are difficult to measure and therefore the datasheets report Ibias and Ioffset

\begin{figure}[H]
	\begin{subfigure}[t]{.5\textwidth}
		\centering
		\begin{circuitikz}
			\draw (0, 0) node[op amp, scale=1.2](opamp){};
			\draw (opamp.out) -- +(0.5, 0) node[ocirc, label=$V_\text{out}$]{};
			\draw (opamp.+) -- +(-0.5, 0) node(node1a)[circ]{} to[current source, l=$I_\text{offset}/2$] (node1a |- opamp.-) node(node1b)[circ]{} -- (opamp.-);
			\draw (node1a) -- ++(-1, 0) node(node2a)[circ]{} -- ++(0, -0.5) to[current source, l=$I_\text{bias}$] ++(0, -1) node[ground]{};
			\draw (node1b) -- ++(-1, 0) node(node2b)[circ]{} -- ++(0, +0.5) to[current source, l_=$I_\text{bias}$] ++(0, 1) node[ground, rotate=180]{};
			\draw (node2a) to[short, i<=$i_+$] +(-1.5, 0) node[ocirc, label=$V_+$]{};
			\draw (node2b) to[short, i<_=$i_-$] +(-1.5, 0) node[ocirc, label=$V_-$]{};
		\end{circuitikz}
		\caption{Equivalent current sources as reported in the datasheet.}
	\end{subfigure}
	\begin{subfigure}[t]{.5\textwidth}
		\centering
		\begin{circuitikz}
			\draw (0, 0) node[op amp, scale=1.2](opamp){};
			\draw (opamp.out) -- +(0.5, 0) node[ocirc, label=$V_\text{out}$]{};
			\draw (opamp.+)-- ++(-0.5, 0) node(node2a)[circ]{} -- ++(0, -0.5) to[current source, l=$I_-$] ++(0, -1) node[ground]{};
			\draw (opamp.-) -- ++(-0.5, 0) node(node2b)[circ]{} -- ++(0, +0.5) to[current source, l_=$I_+$] ++(0, 1) node[ground, rotate=180]{};
			\draw (node2a) to[short, i<=$i_+$] +(-1.5, 0) node[ocirc, label=$V_+$]{};
			\draw (node2b) to[short, i<_=$i_-$] +(-1.5, 0) node[ocirc, label=$V_-$]{};
		\end{circuitikz}
		\caption{Alternative equivalent current sources.}
	\end{subfigure}
	\caption{Non-zero input current from the operational amplifier.}
\end{figure}

\begin{align}
	I_+=I_\text{bias}+\frac{1}{2}I_\text{offset} &&
	I_\text{offset}=I_+-I_- \\
	I_-=I_\text{bias}-\frac{1}{2}I_\text{offset} &&
	I_\text{bias}=\frac{I_++I_-}{2}
\end{align}

\begin{figure}[H]
	\centering
	\begin{circuitikz}
		\draw (0, 0) node[op amp](opamp){};
		\draw (opamp.out) -- +(.5, 0) node[ocirc, label=$V_\text{out}$]{};
		\draw (opamp.-) to[resistor, l_=$R_\text{in}$] +(-3, 0) node(node1){} to[voltage source, l=$V_\text{in}$] (node1 |- +0, -3) node[ground](gnd){};
		\draw (opamp.-) |- (-1, 2) to[resistor, l=$R_f$] (1,2) -| (opamp.out);
		\draw (opamp.+) -- ++(0, -1) node(node2)[circ]{} to[resistor, l_=$R_c$] (opamp.+ |- gnd) node[ground]{};
		\draw (node2) -- ++(1, 0) node(node3){} to[capacitor, l=$C_c$] (node3 |- gnd) node[ground]{};
	\end{circuitikz}
	\caption{Input current offset compensation.}
\end{figure}

\cite[p.~57]{Jung05}
\cite[p.~25]{Graeme96}

\begin{equation}
	R_c=\frac{R_\text{in}R_f}{R_\text{in}+R_f}
\end{equation}

% TODO: mention that this only works for well-matched bias currents (Ioffset < Ibias)
% TODO: give noise argument why this introduces more error

\subsection{Noise}

\subsection{Stability}

\cite[p.~693]{Hobbs11}
\cite[p.~183]{Kay12}
\cite[Ch.~5]{Carter17}
\cite[Ch.~3]{Graeme96}